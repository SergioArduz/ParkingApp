@model IEnumerable<ParkingApp.Models.ParkingSession>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">🚗 Control de Parqueo</h2>
    <div>
        <a asp-action="CreateEntry" class="btn btn-success me-2 shadow-sm">
            <i class="bi bi-box-arrow-in-right"></i> Registrar Entrada
        </a>
        <a asp-action="CreateVehicle" class="btn btn-primary shadow-sm">
            <i class="bi bi-car-front"></i> Registrar Vehículo
        </a>
    </div>
</div>

<!-- DASHBOARD -->
<div class="row g-3 mb-4">
    <div class="col-md-3">
        <div class="stat-card bg-gradient-primary">
            <h5>Total sesiones</h5>
            <h2>@Model.Count()</h2>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card bg-gradient-success">
            <h5>En parqueo</h5>
            <h2>@Model.Count(s => s.Status == "En parqueo")</h2>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card bg-gradient-secondary">
            <h5>Finalizadas</h5>
            <h2>@Model.Count(s => s.Status != "En parqueo")</h2>
        </div>
    </div>
</div>

<!-- FILTROS -->
<div class="row mb-3">
    <div class="col-md-6">
        <input type="text" id="searchPlate" class="form-control shadow-sm" placeholder="🔍 Buscar placa...">
    </div>
    <div class="col-md-4">
        <select id="filterStatus" class="form-select shadow-sm">
            <option value="">Todos</option>
            <option value="En parqueo">En parqueo</option>
            <option value="Fuera del Parqueo">Finalizado</option>
        </select>
    </div>
</div>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success shadow-sm fade-in">@TempData["Success"]</div>
}
@if (TempData["Info"] != null)
{
    <div class="alert alert-info shadow-sm fade-in">@TempData["Info"]</div>
}

<div class="card shadow border-0 rounded-4 animate-fade">
    <div class="card-body table-responsive">
        <table class="table table-hover align-middle" id="parkingTable">
            <thead class="table-light">
                <tr>
                    <th>Placa</th>
                    <th>Entrada</th>
                    <th>Salida</th>
                    <th>Duración</th>
                    <th>Recompensa</th>
                    <th>Estado</th>
                    <th class="text-end">Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var s in Model)
                {
                    <tr class="parking-row" data-status="@s.Status">
                        <td class="plate fw-semibold">@s.Vehicle?.Plate</td>
                        <td>@s.EntryTime.ToLocalTime().ToString("g")</td>
                        <td>@(s.ExitTime?.ToLocalTime().ToString("g") ?? "-")</td>
                        <td>@(s.DurationMinutes?.ToString() ?? "-") min</td>
                        <td>
                            <span class="badge bg-warning text-dark">@s.Reward</span>
                        </td>
                        <td>
                            @if (s.Status == "En parqueo")
                            {
                                <span class="badge bg-success">En parqueo</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary">Finalizado</span>
                            }
                        </td>
                        <td class="text-end">
                            <a asp-action="Details" asp-route-id="@s.SessionId" class="btn btn-sm btn-outline-info">Detalles</a>

                            @if (s.Status == "En parqueo")
                            {
                                <a asp-action="EndSession" asp-route-id="@s.SessionId" class="btn btn-sm btn-outline-danger">Salida</a>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
